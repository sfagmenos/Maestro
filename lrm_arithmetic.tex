\documentclass[12pt]{article}
\usepackage{amssymb,amsmath,amsthm}
\usepackage[pdftex]{graphicx}
\usepackage{tikz}
\usepackage{ulem}
\usepackage{float}
\usepackage{hyperref}
\usepackage[top=1in, bottom=1in, left=.5in, right=1in]{geometry}
\usepackage{algorithm}
\usepackage{algpseudocode} 
\usepackage{bbm}
\usepackage{textcomp}
\usepackage{lmodern}
\usepackage[T1]{fontenc}
\usepackage[latin9]{inputenc}
\usepackage{geometry}
\geometry{verbose,tmargin=3cm,bmargin=3cm,lmargin=3.5cm,rmargin=3.5cm,headheight=3cm,headsep=2cm,footskip=2cm}
\usepackage{amstext}
% \usepackage[margin=1in]{geometry}
\linespread{1.5}

\title{Language Reference Manual Operators}

\author{Mathias Lecuyer, Vaggelis Atlidakis, Georgios Koloventzos, Yiren Lu}
\date{\today}

\begin{document}

\maketitle
\tableofcontents

\section{Introduction}
The Maestro language is a declarative language to schedule jobs with hard and soft dependencies, locally or over the network.
% The C Flat language is mostly a subset of the C language. Some of the core functionalities of C has been stripped:
% there is no preprocessor, no structs, no strings, not even pointers. itâ€™s goal is purely educational. Originally Nico
% and Dan were working on two separate languages. The two projects merged, taking some features from each, and
% this is the resulting language. This document is inspired by the C Reference Manuel by Dennis Ritchie.

\section{Lexical conventions}
\subsection{Whitespace}
Whitespaces are either a tab, a new line, or a white space. At least one white space is required to separate identifiers from
each other, and certain operators.

\subsection{Comments}
Comments are denoted by // and represent a comment that ends with the end of the current line.

\subsection{Identifiers}
An identifier is a sequence of letters, digits, and underscores. The first character must not be a digit.

\subsection{Keywords}
The following identifiers are used as keywords, and are reserved names:\\
if else

\subsection{Built in functions}
The following functions are built into the language, and their names are reserved:\\
map reduce run Job\\
All return a list of Jobs.
\begin{description}
  \item[Job(string, string..)] Job takes a string that is the path of a file to
    execute for the job, and any number of strings that will be passed as
    arguments. It returns a list with a Job object.
  \item[map(list, string)] the first list is a list of jobs that will run first, and their
    stdout will be concatenated. For every line in the concatenated stdout, map will create
    a Job with the string argmuent and the stdout line as an argument. It returns the list
    of created Jobs. This call is asynchronous.
  \item[reduce(list, string)] the first list is a list of jobs that will run first (usually the
    output of a map). String is the path to the reduce program. There will be one Job
    created with that program, with arguments that are the output from the previous reduce and
    the output of the next Job from the list. The first reduce will have nil as first argument.
  \item[run(list)] run takes an arbitrary number of comma separated lists of Jobs
    and runs them. If they have dependencies, these dependencies will run first.
\end{description}

\subsection{Reserved Identifiers}
The following characters are reserved: $\texttt{+ - / * \% -> => <-> \textasciitilde>
\textasciitilde< \textasciitilde , ( ) "}$

\subsection{Types}
Maestro is dynamically typed and doesn't allow users to create new types.
\subsubsection{Basic Types}
\begin{description}
  \item[Job] A Job represents a program that can be ran on a worker. It encapsulates
    the path of the program and exposes outputs and errors.
  \item[Int] Ints are signed integers with arbitrary size.
  \item[String] Strings are delimited by " and have to be on one line.
  \item[Boolean] Boolean encapsulates true or false.
\end{description}

\subsubsection{Derived Types}
\begin{description}
  \item[List] Lists are ordered collections of one or more values. These
    objects do not need to have the same type. The literal representation is a
    comma separated sequence of expressions surrounded by brackets ([ and ]).
\end{description}

\subsection{Scope}
Maestro is a scripting language to quickly distributed interdependent jobs. Its
intended use is for scripts that glue tasks together. The scope of a variable
is thus the entire script, or the whole lifetime of the interpreter.

\subsection{Operators}
Operators are left associative and have the following precedences (same line
means same precedence, lower line means higher precedence):\\
$\texttt{-> => \textasciitilde> \textasciitilde<}$\\
$\texttt{+ - <-> \textasciitilde}$\\
$\texttt{/ * \%}$

\subsection{Expressions}
\subsubsection{identifier}
An identifier evaluates to the value of the corresponding variable.

\subsubsection{( expression )}
A parenthesized expression takes the value of the evaluated expression.

\subsubsection{identifier ( expression-listopt )}
A function call is an expression. The arguments are comma separated and are evaluated
from left to right, before the call. It is possible to have 0 arguments.

\subsubsection{expression + expression}
The result is the sum of the expressions if they evaluate to an Int.\\
The result is the concatenation of the lists if both expressions evaluate to
a list.\\
The result is the concatenation of the strings if both expressions evaluate to
a string.\\
The result is the concatenation of the string and the Int in a string format if
one expression evaluates to a string and the other to an Int.\\

\subsubsection{expression - expression}
The result is the difference of the expressions if they evaluate to an Int.

\subsubsection{expression * expression}
The result is the multiplication of the expressions if they evaluate to an Int.

\subsubsection{expression / expression}
The result is the Integer division of the expressions if they evaluate to an Int.\\
When dividing by 0, the program crashes.

\subsubsection{expression \% expression}
The \% operator yields the remainder from the division of the first expression by the second, if
both expressions evaluate to an Int.

\subsubsection{expression -> expression}
The dependency operator (->) requires both expressions to be lists of Jobs.\\
The call is asynchronous and adds all Jobs in the right hand side list as dependencies
for all Jobs on the left hand side list.\\
It returns a list of Jobs that is the concatenation of both lists.

\subsubsection{expression => expression}
The distributed dependency operator (=>) requires both expressions to be lists of Jobs.\\
The call is asynchronous and adds all Jobs in the right hand side list as dependencies
for all Jobs on the left hand side list. Moreover, the dependent Jobs (right
hand side)  will be ran on the same worker as the previous Job (left hand
side).\\
It returns a list of Jobs that is the concatenation of both lists.

\subsubsection{expression <-> expression}
The parallel operator (<->) requires both expressions to be lists of Jobs.\\
The call is asynchronous and no dependencies are added. It is a visual way to
concatenate lists of Jobs.\\
It returns a list of Jobs that is the concatenation of both lists.

\subsubsection{expression \textasciitilde> expression}
The soft dependency operator (\textasciitilde>) requires both expressions to be lists of Jobs.\\
The call is asynchronous and puts all right hand side Jobs prority to be 1 less than the smallest
priority of the left hand side Jobs.\\
It returns a list of Jobs that is the concatenation of both lists.\\
A soft dependency is a priority indication: if more than one Job can run, Maestro will run the
one with higher priority, but there is no order guaranty, as opposed to dependencies.

\subsubsection{expression \textasciitilde< expression}
The soft dependency operator (\textasciitilde<) requires both expressions to be lists of Jobs.\\
The call is asynchronous and puts all right hand side Jobs prority to be 1 more than the biggest
priority of the left hand side Jobs.\\
It returns a list of Jobs that is the concatenation of both lists.\\
A soft dependency is a priority indication: if more than one Job can run, Maestro will run the
one with higher priority, but there is no order guaranty, as opposed to dependencies.

\subsubsection{expression \textasciitilde expression}
The soft parallel operator (\textasciitilde) requires both expressions to be lists of Jobs.\\
The call is asynchronous and no priorities are changed. It is a visual way to
concatenate lists of Jobs.\\
It returns a list of Jobs that is the concatenation of both lists.

\subsubsection{identifier = expression}
The value of the variable wich name is the identifier value is replaced by the value of the expression
evaluates to. If the variable doesn't exist, it is create: the programmer doesn't need to declare the
variable beforehand.\\
The default value of the variable is not determined.

\section{Statements}
Statements are executed in sequence.

\subsection{statement}
Most statement are expression statements, which have the form\\
expression ;

\subsection{statement-list}
Most statement are expression statements, which have the form\\
statement statement-list\\
statement

\subsection{Conditional statement}
The two forms of the conditional statement are:\\
if ( expression ) { statement-list }\\
if ( expression ) { statement-list } else { statement-list }\\

In both cases the expression is evaluated. If it is true, the first statements will be evaluated.
If it is false and there is an else, the else statements will be evaluated.

% 5
% Program definition
% A ltc program consists of a sequence of function definition.
% program:
% function-definition
% function-definition program
% function-definition:
% identifier ( parameter-listopt ) { statement-listopt }
% parameter-list:
% identifier
% identifier , parameter-list
% the same identifier cannot be used more than once in the parameter list. Within the same program, A function
% cannot be defined twice (name wise).
% All functions return a integer value. A function can return to the caller without an explicit return statement, in
% this case the return value is undefined.
% A simple example of a complete function definition:
% max (a, b, c) {
% if (a > b) m = a; else m = b;
% if (m > c) return m; else return c;
% }

% 9
% 9.1
% Syntax Summary
% Expressions
% expression:
% identifier
% literal
% ( expression )
% identifier ( expression-listopt )
% -expression
% +expression
% !expression
% âˆ¼expression
% ++identifier
% --identifier
% identifier++
% identifier--
% expression binop expression
% identifier asgnop expression
% expression-list:
% expression
% expression , expression-list
% The unary operators - + ! âˆ¼ have higher priority than binary operator.
% Binary operators all group left to right and have priority decreasing as indicated:
% binop:
% * / %
% 7
% + -
% >> <<
% < > <= >=
% == !=
% &
% âˆ§
% |
% &&
% ||
% Assignment operator all have the same priority, and all group right to left.
% asgnop:
% = += -= *= /= %= >>= <<= &= âˆ§ = |=
% 9.2
% Statements
% statement:
% expression ;
% { statement-listopt }
% if ( expression ) statement
% if ( expression ) statement else statement
% while ( expression ) statement
% for ( expressionopt ; expressionopt ; expressionopt ) statement
% break;
% continue;
% return expression;
% try { statement-listopt }catch { statement-listopt }
% try { statement-listopt }catch ( identifier ) { statement-listopt }
% throw expression;
% ;
% statement-list:
% statement
% statement statement-list
% 8
% 9.3
% Program definition
% program:
% function-definition
% function-definition program
% function-definition:
% identifier ( parameter-listopt ) { statement-listopt }
% parameter-list:
% identifier
% identifier , parameter-list
% 9
\end{document}

